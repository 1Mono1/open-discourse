name: "Recreate Database"

on:
  push:
    branches: [OD-56-add-custom-runner]
  schedule:
    - cron: "0 0 1 * *"

jobs:
  setup:
    name: Setup environment
    runs-on: self-hosted

    steps:
      - run: |
          cd ~/open-discourse
          git checkout main
          git pull
          cd ./database
          yarn
          rm -rf data
          cd ../python
          rm -rf .venv
          chmod +x setup.sh
          ./setup.sh
  build:
    name: Build
    runs-on: self-hosted
    needs: setup

    steps:
      - run: |
          cd ~/open-discourse/python
          chmod +x build.sh
          ./build.sh
  # publish:
  #   name: publish
  #   runs-on: self-hosted
  #   # needs: [setup, build]
  #   needs: setup

  #   steps:
  #     - run: |
  #         cd ~/open-discourse/database
  #         yarn version --patch
  #         echo $PWD
